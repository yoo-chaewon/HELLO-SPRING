## 2. ìŠ¤í”„ë§IoC(Inversion of Control) 

> https://martinfowler.com/articles/injection.html

###### ì œì–´ê¶Œì´ ì—­ì „ë˜ì—ˆë‹¤.



- **ì¼ë°˜ì ì¸ (ì˜ì¡´ì„±ì— ëŒ€í•œ) ì œì–´ê¶Œ: â€œë‚´ê°€ ì‚¬ìš©í•  ì˜ì¡´ì„±ì€ ë‚´ê°€ ë§Œë“ ë‹¤.â€** 

```java
class OwnerController {
  private OwnerRepository repository = new OwnerRepository();
  //ì¼ë°˜ì ì¸ ì˜ì¡´ì„±ì€ ìê¸°ê°€ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì‚¬ìš©
}
```

##### 

- **IoC: â€œë‚´ê°€ ì‚¬ìš©í•  ì˜ì¡´ì„±ì„ ëˆ„êµ°ê°€ ì•Œì•„ì„œ ì£¼ê² ì§€â€**

```java
class OwnerController {
  private OwnerRepository repo;
	public OwnerController(OwnerRepository repo) { 
    //ë°–ì—ì„œ ëˆ„ê°€ ë§Œë“¤ì–´ì„œ ì¤„ìˆ˜ ìˆê²Œë”, ìƒì„±ìë¥¼ í†µí•´ ë°›ì•„ì˜´
    this.repo = repo;
  } 
  // repoë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ,
  // ì—¬ê¸°ì„œ ë§Œë“¤ì§€ëŠ” ì•ŠìŒ,
}
```

ğŸ‘‰ ë”°ë¼ì„œ, ì˜ì¡´ì„± ë§Œë“œëŠ” ì½”ë“œëŠ” OwnerControllerê°€ í•˜ì§€ ì•ŠìŒ. (ë°–ì—ì„œ í•´ì¤Œ !)

ğŸ‘‰ **ë‚´ê°€ ì˜ì¡´ì„± ë§Œë“œëŠ”ê²Œ ì•„ë‹Œ, ì™¸ë¶€ì˜ ëˆ„êµ°ê°€ ! **

**ğŸ‘‰ ì œì–´ê¶Œì´ ì—­ì „ ë˜ì—ˆë‹¤ ~**

> - ë‚´ê°€ ì‚¬ìš©í•  ì˜ì¡´ì„±ì˜ íƒ€ì…(ë˜ëŠ” ì¸í„°í˜ì´ìŠ¤)ë§Œ ë§ìœ¼ë©´ ì–´ë–¤ê±°ë“  ìƒê´€ì—†ë‹¤.
> - ê·¸ë˜ì•¼ ë‚´ ì½”ë“œ í…ŒìŠ¤íŠ¸ í•˜ê¸°ë„ í¸í•˜ì§€.
> - DIë„ ì¼ì¢…ì˜ IoC, ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì£¼ëŠ” ê²ƒì„ DI / ì´ ê°œë… ìì²´ë¥¼ IoC

```java
class OwnerControllerTest {
  @Test
  public void create() {
    OwnerRepository repo = new OwnerRepository();
    OwnerController controller = new OwnerController(repo);//ğŸ‘‰OwnerControllerì•ˆì—ì„œ repoë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” OwnerControllerë¥¼ ìƒì„±í•  ë•Œ OwnerRepositoryë¥¼ ë§Œë“¤ì–´ì•¼í•¨.
  }
}
```

###  

#### ë¹ˆ(bean)

- ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ê°ì²´



### IoC (Inversion of Control) ì»¨í…Œì´ë„ˆ 

###### ApplicationContext (BeanFactory)

- ë¹ˆ(bean)ì„ ë§Œë“¤ê³  ì—®ì–´ì£¼ë©° ì œê³µí•´ì¤€ë‹¤.
- ë¹ˆë“¤ì˜ ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ê³ , ë¹ˆë“¤ì˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë“±ë¡,
- ê°ì²´ë“¤ì„ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì˜ì¡´ì„± ê´€ë¦¬(í•„ìš”í•œ ì˜ì¡´ì„± ìƒì„±, ì–´ë…¸í…Œì´ì…˜ ë“±ì„ ë³´ê³ ,)



#### ë¹ˆ ì„¤ì •

###### ëª¨ë“ ê±° ë¹ˆ ? NO !

â—   ì´ë¦„ ë˜ëŠ” ID

â—   íƒ€ì…

â—   ìŠ¤ì½”í”„



###### ì•„ì´ëŸ¬ë‹ˆí•˜ê²Œë„ ì»¨í…Œì´ë„ˆë¥¼ ì§ì ‘ ì“¸ ì¼ì€ ë§ì§€ ì•Šë‹¤.



##### ì°¸ê³ 

> â—   https://spring.io/understanding/application-context
>
> â—   https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html
>
> â—   https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/BeanFactory.html



 

### ë¹ˆ (Bean)

###### ìŠ¤í”„ë§ IoC ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ëŠ” ê°ì²´



#### ë“±ë¡í•˜ëŠ” ë°©ë²•

> - Component Scanning
>   - @Component ğŸ‘‰ `life cycle` í•˜ë©´ì„œ ë¹ˆìœ¼ë¡œ ë“±ë¡(annotation ê°ë³„ì‚¬)
>     - @Repository
>     - @Service
>     - @Controller
>     - @Configuration
>     - +íŠ¹ì • ì¸í„°í˜ì´ìŠ¤ ìƒì† ë°›ì€ ê²½ìš°,
>     - ë“± !

> - ë˜ëŠ” ì§ì ‘ ì¼ì¼íˆ XMLì´ë‚˜ ìë°” ì„¤ì • íŒŒì¼ì— ë“±ë¡



#### ì–´ë–»ê²Œ êº¼ë‚´ì“°ì§€?

> - @Autowired ë˜ëŠ” @Inject âœ”ï¸ ì´ê±° ë” ì„ í˜¸ ~
> - ë˜ëŠ” ApplicationContextì—ì„œ getBean()ìœ¼ë¡œ ì§ì ‘ êº¼ë‚´ê±°ë‚˜



#### íŠ¹ì§•

â—   **ì˜¤ë¡œì§€ â€œë¹ˆ"ë“¤ë§Œ ì˜ì¡´ì„± ì£¼ì…ì„ í•´ì¤ë‹ˆë‹¤.**

â€‹	ì¦‰, ìŠ¤í”„ë§ IoC ì»¨í…Œì´ë„ˆì— ë“¤ì–´ ìˆëŠ” ê°ì²´ ë¼ë¦¬ë§Œ, ì˜ì¡´ì„± ì£¼ì…. ë°–ì— ìˆëŠ” ê°ì²´ì— X

 

### ì˜ì¡´ì„± ì£¼ì… (Dependency Injection)

###### í•„ìš”í•œ ì˜ì¡´ì„±ì„ ì–´ë–»ê²Œ ë°›ì•„ì˜¬ê²ƒì¸ê°€ .



#### @Autowired / @Injectë¥¼ ì–´ë””ì— ë¶™ì¼ê¹Œ?

> - ìƒì„±ì âœ”ï¸ ê¶Œì¥í•˜ëŠ” ë°©ë²•
>
>   ```java
>   private final OwnerRepository owners;
>   private VisitRepository visits;
>   
>   public OwnerController(OwnerRepository clinicService, VisitRepository visits) {
>   		this.owners = clinicService;
>   		this.visits = visits;
>   }
>   ```
>
> - í•„ë“œ
>
> - Setter -> Setterì— Autowired

 

##### ê³¼ì œ

â—   OwnerControllerì— PetRepository ì£¼ì…í•˜ê¸°

```java
//#1. setterì´ìš©í•œ ë°©ë²•
private PetRepository petRepository;
@Autowired
public void setPetRepository(PetRepository petRepository) {
  this.petRepository = petRepository;
}
```

 

```java
//#2. ìƒì„±ì í†µí•œ ë°©
public OwnerController(OwnerRepository clinicService, VisitRepository visits, PetRepository petRepository) {
  this.owners = clinicService;
  this.visits = visits;
  this.petRepository = petRepository;
}
```

 

 

 



 



 